
<% layout("layouts/boilerplate") %>
<style>
    @media (min-width: 768px) {
    .helli{
    margin-left: 200px;
    margin-top:100px;
  }}
</style>
<div class="helli">
<div class="container mt-4">
  <h4 class="mb-3">ðŸ”„ DropPoint Funnel Overview</h4>
  <table class="table table-bordered mt-4">
  <thead class="table-dark">
    <tr>
      <th>Step</th>
      <th>Today</th>
      <th>Yesterday</th>
     
    </tr>
  </thead>
  <tbody>
    <% funnel.forEach(f => { 
         const change = f.yesterday === 0 ? 'âˆž' : (((f.today - f.yesterday) / f.yesterday) * 100).toFixed(1);
         const trendClass = change >= 0 ? 'text-success' : 'text-danger';
    %>
      <tr>
        <td><%= f.step.replace(/_/g, ' ').toUpperCase() %></td>
        <td><%= f.today %></td>
        <td><%= f.yesterday %></td>
      
      </tr>
    <% }) %>
  </tbody>
</table>

</div>

<canvas id="funnelChart" height="100"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('funnelChart').getContext('2d');

  const todayGradient = ctx.createLinearGradient(0, 0, 0, 400);
  todayGradient.addColorStop(0, 'rgba(0, 123, 255, 0.4)');
  todayGradient.addColorStop(1, 'rgba(0, 123, 255, 0.05)');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: <%- JSON.stringify(funnel.map(f => f.step.replace(/_/g, ' ').toUpperCase())) %>,
      datasets: [
        {
          label: "Today",
          data: <%- JSON.stringify(funnel.map(f => f.today)) %>,
          borderColor: '#007bff',
          backgroundColor: todayGradient,
          pointBackgroundColor: '#007bff',
          pointBorderColor: '#fff',
          pointRadius: 5,
          pointStyle: 'circle',
          fill: true,
          tension: 0.3
        },
        {
          label: "Yesterday",
          data: <%- JSON.stringify(funnel.map(f => f.yesterday)) %>,
          borderColor: '#FF851B',
          borderDash: [6, 3],
          pointBackgroundColor: '#FF851B',
          pointBorderColor: '#fff',
          pointRadius: 5,
          pointStyle: 'rectRot',
          fill: false,
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "ðŸ“Š Funnel: Today vs Yesterday",
          font: { size: 18, weight: "bold" },
          color: "#333"
        },
        legend: {
          position: 'top',
          labels: {
            color: '#333',
            usePointStyle: true
          }
        },
        tooltip: {
          backgroundColor: '#000',
          titleColor: '#fff',
          bodyColor: '#fff',
          padding: 10
        }
      },
      scales: {
        x: {
          ticks: {
            color: '#555',
            font: { weight: '600' }
          },
          grid: {
            display: true,
            color: '#eee'
          }
        },
        y: {
          beginAtZero: true,
          ticks: {
            color: '#555',
            stepSize: 1
          },
          grid: {
            color: '#eee',
            borderDash: [4, 4]
          }
        }
      }
    }
  });
</script>




